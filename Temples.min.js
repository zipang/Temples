/**
 * Temples.js
 * ============
 * Author: Eidolon Labs (zipang)
 * Source : http://github.com/zipang/Temples
 * Date: 2012-10-29
 * v0.2.0
 */(function(t,n){function s(e){if(!e)return"undefined";var t=e.tagName,n=e.id,r=e.className;return t+(n?"#"+n:"")+(r?"."+r:"")}function o(e){return n("<!--"+e+"-->")}function u(e,t,n){var r,i,s=t,o=(e||"").trim().split(".");while(s&&(r=o.shift()))i=s,s=s[r];return typeof s=="function"?s.call(i,n):s||""}function a(){}function f(e,t){this.$root=e,this.bindings=[d.updater(e,t)],this.toString("AttributeRenderer("+s(e[0])+"["+t+"])")}function l(e,t){this.$root=e,this.toString("SimpleElementRenderer("+s(e[0])+"["+t+"])");var n=this.bindings=[],r,i=t.split(",");while(r=i.pop())n.push(d.updater(e,r.trim()))}function c(e,t,n){if(!arguments.length)return;this.$root=e,this.condition=t;var r=this.conditionalbindings=[];this.toString("ConditionalElementRenderer("+s(e[0])+"["+n+"] if "+t+")");if(n){var i=n.split(",");for(var o=0,a;a=i[o++];)r.push(d.updater(e,a.trim()))}var f=this;this.bindings=[function(e){if(u(t,e)){for(var n=0,i;i=r[n++];)i(e);f.reappear()}else f.disappear("Temples says: "+t+"=false")}]}function h(e,t,n,r){this.$root=e;var i=e.children().first();if(!i.length)throw"List Renderer "+s(e[0])+" for ("+t+") must have at least a child block!";var o=this.template=new p(this.toString(),i);this.toString("ListRenderer("+s(e[0])+"["+r+"] if "+n+")\n"+"iterate "+t+" with "+o);var a=t.replace("from",":"),f=a.split(":"),l=f[1]||f[0],h=this.seed=l.trim();f.length==2?this.varName=f[0].trim():(this.varName=this.seed.split(".").pop(),this.varName=this.varName.replace(/s*$/,""));var d=this.varName;c.call(this,e,n,r),this.conditionalbindings.push(function(t){var n=u(h,t);e.empty();for(var r=0,i=n.length;r<i;r++)t[d]=n[r],e.append(o.render(t).clone());delete t[d]})}function p(e,t){this.$root=t||e,t&&(this.name=e),this.toString("TemplateRenderer("+(t?this.name+", ":"")+s(t[0])+")");var r=this.bindings=[];t.each(function(e,t){var i=a.targets(n(t));i.each(function(e,t){var i=a.Factory(n(t));i&&Array.prototype.push.apply(r,i.bindings)})})}if(!n)throw"Temples relies on a jQuery compatible DOM search engine and DOM manipulator";var r=[];console||(window.console={log:function(){}});var i=String.prototype;i.startsWith=i.startsWith||function(e){return this.indexOf(e)===0},i.contains=i.contains||function(e){return this.indexOf(e)!==-1},a.prototype={render:function(e){var t=this.bindings,n=t.length;for(var r=0;r<n;r++)t[r](e);return this.$root},output:function(e){this.render(e);var t=[];try{this.$root.each(function(e,n){t.push(n.outerHTML)})}catch(n){if(XMLSerializer){var r=new XMLSerializer;this.$root.each(function(e,n){t.push(r.serializeToString(n))})}}return t.join("")},toHtml:function(){return this.$root.html()},destroy:function(){this.bindings=this.$root=null,this.name&&(delete v[this.name],r.splice(r.indexOf(this.name),1))},toString:function(e){if(!e)return"Renderer";this.toString=function(){return e}}},f.prototype=new a,l.prototype=new a,n.extend(c.prototype=new a,{disappear:function(e){this.placeHolder||this.$root.replaceWith(this.placeHolder=o(e))},reappear:function(){this.placeHolder&&(this.placeHolder.replaceWith(this.$root),this.placeHolder=null)}}),h.prototype=new c,a.isListRenderer=h.loopExpression=function(e){try{return e.attr("data-iterate")||e.attr("data-each")}catch(t){return""}},p.prototype=new a,a.targets=function(e){var t=function(){return n(this).attr("data-bind")||n(this).attr("data-render-if")},r=function(){return n(this).parentsUntil(e,"[data-iterate], [data-each]").length==0};return a.isListRenderer(e)?e:e.filter(t).add(n("*[data-bind], *[data-render-if]",e).filter(r)).add(n("*[data-iterate], *[data-each]",e).filter(r))};var d={updater:function(e,t){console.log("Binding '"+t+"' for element "+s(e[0]));var n=t.split("=");if(n.length==1){var r=n[0],i=e[0].tagName.toLowerCase();return"input|select".contains(i)?function(t){e.val(u(r,t,e))}:function(t){e.html(u(r,t,e))}}var o=n[0].toLowerCase(),r=n[1];if(o.startsWith("class")){var a=/\[([\w|\|]+)\]/g.exec(o);return a?(a=a[1].split("|").join(" "),function(t){e.removeClass(a),e.addClass(u(r,t,e))}):function(t){e.attr("class",u(r,t,e))}}return"text|html|value".contains(o)?function(t){e[o](u(r,t,e))}:function(t){e.attr(o,u(r,t,e))}}};a.Factory=function(e){var t=e.attr("data-bind"),n=e.attr("data-render-if"),r=e.attr("data-iterate")||e.attr("data-each");e.removeAttr("data-bind data-render-if data-iterate data-each");if(r)return new h(e,r,n,t);if(n)return new c(e,n,t);if(t&&t.contains(","))return new l(e,t);if(t)return new f(e,t)};var v={Renderer:p,prepare:function(e,t){if(!t){if(e.startsWith("#"))t=n(e);else if(e=="document")t=n("html");else if(e.startsWith("<")||e.contains(" "))t=e,e=undefined}else n.fetchDocument&&n.fetchDocument(t);return e?(r.push(e),v[e]=new v.Renderer(e,n(t))):new v.Renderer(n(t))},destroy:function(e){e?v[e]&&v[e].destroy():r.forEach(v.destroy)},render:function(e,t){!t&&typeof e=="object"&&(t=e,e="document"),(v[e]||v.prepare(e)).render(t)}};v.register=v.prepare,t.window?t.window.Temples=v:module&&module.exports&&(module.exports=v)})(this,this.jQuery||this.ender||this.jquip||require("buck"));