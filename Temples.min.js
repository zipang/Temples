/**
 * Temples.js
 * ============
 * Author: Eidolon Labs (zipang)
 * Source : http://github.com/zipang/Temples
 * Date: 2012-10-29
 * v0.2.0
 */(function(t,n){function i(e){var t=e.prop("tagName").toLowerCase(),n=e.attr("id"),r=e.attr("class");return t+(n?"#"+n:"")+(r?"."+r:"")}function s(e){return n("<!--"+e+"-->")}function o(e,t,n){var r,i,s=t,o=(e||"").trim().split(".");while(s&&(r=o.shift()))i=s,s=s[r];return typeof s=="function"?s.call(i,n):s||""}function u(){}function a(e,t){this.$root=e,this.bindings=[p.updater(e,t)]}function f(e,t){this.$root=e;var n=this.bindings=[],r,i=t.split(",");while(r=i.pop())n.push(p.updater(e,r.trim()))}function l(e,t,n){if(!arguments.length)return;this.$root=e,this.condition=t;var r=this.conditionalbindings=[];if(n){var i=n.split(",");for(var s=0,u;u=i[s++];)r.push(p.updater(e,u.trim()))}var a=this;this.bindings=[function(e){if(o(t,e)){for(var n=0,i;i=r[n++];)i(e);a.reappear()}else a.disappear("Temples says: "+t+"=false")}]}function c(e,t,n,r){this.$root=e;var i=this.template=new h(e.children().first()),s=t.replace("from",":"),u=s.split(":"),a=u[1]||u[0],f=this.seed=a.trim();u.length==2?this.varName=u[0].trim():(this.varName=this.seed.split(".").pop(),this.varName=this.varName.replace(/s*$/,""));var c=this.varName;l.call(this,e,n,r),this.conditionalbindings.push(function(t){var n=o(f,t);e.empty();for(var r=0,s=n.length;r<s;r++)t[c]=n[r],e.append(i.render(t).clone());delete t[c]})}function h(e){this.$root=e;var t=this.bindings=[];e.each(function(e,r){var i=u.targets(n(r));i.each(function(e,r){var i=u.Factory(n(r));Array.prototype.push.apply(t,i.bindings)})})}if(!n)throw"Temples relies on a jQuery compatible DOM search engine and DOM manipulator";var r={};console||(window.console={log:function(){}}),u.prototype={render:function(e){var t=this.bindings,n=t.length;for(var r=0;r<n;r++)t[r](e);return this.$root},output:function(e){return this.render(e).html()},toHtml:function(){return this.$root.html()},destroy:function(){this.bindings=this.$root=null}},a.prototype=new u,a.prototype.toString=function(){return"AttributeRenderer("+i(this.$root)+")"},f.prototype=new u,f.prototype.toString=function(){return"SimpleElementRenderer("+i(this.$root)+")"},n.extend(l.prototype=new u,{disappear:function(e){this.placeHolder||this.$root.replaceWith(this.placeHolder=s(e))},reappear:function(){this.placeHolder&&(this.placeHolder.replaceWith(this.$root),this.placeHolder=null)}}),l.prototype.toString=function(){return"ConditionalElementRenderer("+i(this.$root)+" if "+this.condition+")"},c.prototype=new l,c.prototype.toString=function(){return"ListRenderer("+i(this.$root)+")"},u.isListRenderer=c.loopExpression=function(e){try{return e.attr("data-iterate")||e.attr("data-each")}catch(t){return""}},h.prototype=new u,h.prototype.toString=function(){return"TemplateRenderer("+i(this.$root)+")"},u.targets=function(e){var t=function(){return n(this).attr("data-bind")||n(this).attr("data-render-if")},r=function(){return n(this).parentsUntil(e,"[data-iterate], [data-each]").length==0};return u.isListRenderer(e)?e:e.filter(t).add(n("*[data-bind], *[data-render-if]",e).filter(r)).add(n("*[data-iterate], *[data-each]",e).filter(r))};var p={updater:function(e,t){console.log("Binding '"+t+"' for element "+i(e));var n=t.split("=");if(n.length==1){var r=n[0],s=e[0].tagName.toLowerCase();return"input|select".indexOf(s)!=-1?function(t){e.val(o(r,t,e))}:function(t){e.html(o(r,t,e))}}var u=n[0].toLowerCase(),r=n[1];if(u.indexOf("class")==0){var a=/\[([\w|\|]+)\]/g.exec(u);return a?(a=a[1].split("|").join(" "),function(t){e.removeClass(a),e.addClass(o(r,t,e))}):function(t){e.attr("class",o(r,t,e))}}return"text|html|value".indexOf(u)!=-1?function(t){e[u](o(r,t,e))}:function(t){e.attr(u,o(r,t,e))}}};u.Factory=function(e){var t=e.attr("data-bind"),n=e.attr("data-render-if"),r=e.attr("data-iterate")||e.attr("data-each");return e.removeAttr("data-bind data-render-if data-iterate data-each"),r?new c(e,r,n,t):n?new l(e,n,t):t.indexOf(",")>0?new f(e,t):new a(e,t)};var d={Renderer:h,prepare:function(e,t){return t||(e.indexOf("#")==0?t=n(e):e=="document"&&(t=n("html"))),r[e]=new d.Renderer(t)},destroy:function(e){r[e]&&r[e].destroy(),delete r[e]},render:function(e,t){!t&&typeof e=="object"&&(t=e,e="document"),(r[e]||d.prepare(e)).render(t)}};d.register=d.prepare,t===window?t.Temples=d:t.exports=d})(this,window.jQuery||window.ender||window.jquip||require("./lib/jquery4node"));