/**
 * Temples.js
 * ============
 * Author: Eidolon Labs (zipang)
 * Source : http://github.com/zipang/Temples
 * Date: 2012-10-17
 * v0.1.1
 */(function(t,n){function i(e){var t=e.prop("tagName").toLowerCase(),n=e.attr("id"),r=e.attr("class");return t+(n?"#"+n:"")+(r?"."+r:"")}function s(e,t,n){var r,i,s=e,o=(t||"").trim().split(".");while(s&&(r=o.shift()))i=s,s=s[r];return console.log("extract Data : ",e,t,">",s),typeof s=="function"?s.call(i,n):s||""}function u(e){if(!e)return;this.$root=n(e),u.bindContent.call(this,this.$root)}function a(e){this.$root=e,this.template=new u(e.children().first()),a.extractLoop(a.loopExpression(e),this)}if(!n)throw"Temples relies on a jQuery compatible DOM search engine and DOM manipulator";var r={};console||(window.console={log:function(){}});var o={toggler:function(e,t){return function(n){e.toggle(s(n,t))}},updater:function(e,t,n){console.log("Binding '"+t+"' for element "+i(e));var r,o=t.split("=");if(o.length==1){var u=o[0],a=e[0].tagName.toLowerCase();"input|select".indexOf(a)!=-1?r=function(t){e.val(s(t,u,e))}:r=function(t){e.html(s(t,u,e))}}else{var f=o[0].toLowerCase(),u=o[1];f=="class"?r=function(t){e.addClass(s(t,u,e))}:"text|html|value".indexOf(f)!=-1?r=function(t){e[f](s(t,u,e))}:r=function(t){e.attr(f,s(t,u,e))}}return n?function(t){s(t,n)?(r(t),e.show()):e.hide()}:r}};u.prototype={render:function(e){for(var t=0,n=this.bindings,r;r=n[t++];)r(e);return this.$root},output:function(e){this.render(e).html()},toHtml:function(){return this.$root.html()},destroy:function(){this.bindings=this.$root=null}},a.prototype=new u,a.prototype.render=function(e){var t=s(e,this.seed),n=this.varName;this.$root.empty();for(var r=0,i;i=t[r++];)e[n]=i,this.$root.append(this.template.render(e).clone());delete e[n]},u.isIterator=a.loopExpression=function(e){try{return e.attr("data-iterate")||e.attr("data-each")}catch(t){return""}},a.extractLoop=function(e,t){var n=e.replace("from",":"),r=n.split(":"),i=r[1]||r[0];t.seed=i.trim(),r.length==2?t.varName=r[0].trim():(t.varName=t.seed.split(".").pop(),t.varName=t.varName.replace(/s*$/,""))},u.bindContent=function(e){var t=this.bindings=[],r=function(){return n(this).parentsUntil(e,"[data-iterate], [data-each]").length==0},i=function(e,r){var i=n(r),s=new a(i);t.push(function(e){s.render(e)}),i.removeAttr("data-iterate data-each")},s=function(e,r){var i=n(r),s=i.attr("data-render-if"),u=i.attr("data-bind");if(s&&!u)t.push(o.toggler(i,s));else{var a=(u||"").split(/\s*,\s*/);for(var e=0,f;f=a[e++];)t.push(o.updater(i,f,s))}i.removeAttr("data-bind data-render-if")};u.isIterator(e)?e.each(i).each(s):(n("*[data-bind], *[data-render-if]",e).filter(r).add(e).each(s),n("*[data-iterate], *[data-each]",e).filter(r).each(i))};var f={Renderer:u,prepare:function(e,t){return t||e.indexOf("#")==0&&(t=n(e)),r[e]=new u(t)},destroy:function(e){r[e]&&r[e].destroy(),delete r[e]},render:function(e,t){var i;!t&&typeof e=="object"&&(t=e,i=f.prepare(e="window.document",n("html"))),(i||r[e]||f.prepare(e)).render(t)}};f.register=f.prepare,t===window?t.Temples=f:t.exports=f})(this,this.jQuery||this.ender||this.jquip||require("./lib/jquery4node"));